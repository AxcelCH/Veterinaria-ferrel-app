<div class="pagos-container">
  <header class="pagos-header">
    <h1 class="pagos-title text-center">Detalles de pago</h1>
  </header>

  <section class="top-section">
    <div class="flex w-full flex-col items-center gap-4">
      <!-- Fila para ID de Orden de Pago -->
      <div class="flex w-full items-center justify-center gap-4">
        <div class="flex w-1/4 flex-col gap-2">
          <label for="orderId">ID de Orden de Pago</label>
          <p-autocomplete
            [(ngModel)]="id"
            [suggestions]="items"
            (completeMethod)="buscar($event)"
            (onSelect)="onSelectOrden($event.value)"
            field="idOrden"
            dropdown
            [forceSelection]="true"
          ></p-autocomplete>
        </div>
        <div class="flex gap-2">
          <p-button
            label="Eliminar"
            icon="pi pi-trash"
            severity="danger"
          ></p-button>
        </div>
      </div>
      <!-- Fila para Monto de la consulta -->
      <div class="flex w-full items-center justify-center gap-4">
        <div class="flex w-1/4 flex-col gap-2">
          <label for="consultaMonto">Monto de la consulta</label>
          <p-inputnumber
            [(ngModel)]="consulta"
            [useGrouping]="false"
            [min]="0"
            [max]="100"
            [maxFractionDigits]="2"
          ></p-inputnumber>
          <small class="text-xs text-gray-500">Monto máximo de 100 soles</small>
        </div>
        <div class="flex gap-2">
          <p-button
            label="Agregar"
            icon="pi pi-search"
            severity="success"
            (onClick)="anadirConsulta()"
          ></p-button>
          <p-button
            label="Eliminar"
            icon="pi pi-trash"
            severity="danger"
            (onClick)="eleminarConsulta()"
          ></p-button>
        </div>
      </div>
    </div>
  </section>

  <section class="table-section mt-6">
    <p-table [value]="products" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>Tipo</th>
          <th>Descripción</th>
          <th>Cantidad</th>
          <th>Precio total</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product.tipo }}</td>
          <td>{{ product.descripcion }}</td>
          <td>{{ product.cantidad }}</td>
          <td>{{ product.subtotal }}</td>
        </tr>
      </ng-template>
    </p-table>
  </section>

  <section class="summary-section mt-6">
    <div class="total-info flex items-center justify-between">
      <span class="total-label text-lg font-semibold">Monto total:</span>
      <span class="total-amount text-lg font-semibold">{{ monto }}</span>
    </div>
    <div class="action-button mt-4 flex justify-center">
      <p-button label="Confirmar pago" icon="pi pi-print" (onClick)="visiblePagar = true" [disabled]="!products.length"
        ><i class="fa fa-shopping-cart" aria-hidden="true"></i
      ></p-button>
    </div>
  </section>
</div>

<p-dialog
  header="Confirmar pago"
  [(visible)]="visiblePagar"
  [modal]="true"
  [style]="{ width: '50vw' }">
  <div class="p-fluid">
    <div class="p-field">
      <label for="dni">DNI</label>
      <input id="dni" type="text" pInputText [(ngModel)]="dni" (ngModelChange)="validateDni()" maxlength="8">
      <small *ngIf="dniError" class="p-error">DNI inválido. Debe tener 8 dígitos.</small>
    </div>
    <div class="p-field">
      <label>Resumen del carrito</label>
      <p-table [value]="products" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Tipo</th>
            <th>Descripción</th>
            <th>Cantidad</th>
            <th>Precio total</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>{{ product.tipo }}</td>
            <td>{{ product.descripcion }}</td>
            <td>{{ product.cantidad }}</td>
            <td>{{ product.subtotal }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div class="p-field">
      <label>QR de Yape</label>
      <img src="ruta/a/tu/qr/yape.png" alt="QR de Yape" style="width: 200px; height: 200px;">
    </div>
    <div class="p-field">
      <p-button label="Pagar" icon="pi pi-check" (onClick)="confirmarPago()" [disabled]="dniError || !dni"></p-button>
    </div>
  </div>
</p-dialog>